# GitOps Manifests for Tyk Control Plane

This directory contains ArgoCD applications and manifests for deploying Tyk Control Plane using GitOps.

## âš ï¸ Important: Demo Repository

This is a **demo repository**. For production use:

1. **Fork this repository** to your own GitHub account/organization
2. **Update the repository URL** in the ArgoCD applications
3. **Customize secret names** and configurations as needed

## ğŸ” Secrets Management

**No secrets are stored in Git.** All sensitive data is managed through:

1. **Infrastructure secrets**: Generated by Terraform and extracted via scripts
2. **Kubernetes secrets**: Created by `setup-gitops.sh` script
3. **Secret references**: Helm values reference existing Kubernetes secrets

## ğŸ“ Structure

```
gitops/
â”œâ”€â”€ applications/           # ArgoCD Applications (App-of-Apps pattern)
â”‚   â”œâ”€â”€ root-app.yaml      # Root application managing others
â”‚   â”œâ”€â”€ prerequisites-app.yaml  # Prerequisites (cert-manager, CRDs)
â”‚   â””â”€â”€ control-plane-app.yaml  # Tyk Control Plane components
â”œâ”€â”€ prerequisites/         # Prerequisites manifests
â”‚   â”œâ”€â”€ namespaces.yaml   # Kubernetes namespaces
â”‚   â”œâ”€â”€ cert-manager-app.yaml  # cert-manager installation
â”‚   â””â”€â”€ tyk-operator-crds.yaml # Tyk Operator CRDs
â””â”€â”€ control-plane/        # Control plane manifests
    â”œâ”€â”€ application.yaml  # Tyk Control Plane Helm application
    â””â”€â”€ values.yaml       # Helm values with secret references
```

## ğŸš€ Usage

### Prerequisites
1. Infrastructure deployed with Terraform
2. Secrets extracted with `./scripts/extract-infrastructure-secrets.sh`
3. ArgoCD installed with `make install-argocd`

### Deploy Applications
```bash
# Setup Tyk applications in ArgoCD
make setup-tyk-applications

# Check status
make gitops-status
```

## ğŸ”„ For Demo Users

To use this demo:

1. **Fork this repository** (GitOps manifests already included)
2. **Run the deployment scripts** (auto-detects your fork)
3. **Customize configurations** as needed (optional)

The setup script automatically detects your forked repository and configures all ArgoCD applications to use it!

## ğŸ› ï¸ Customization

### Repository Auto-Detection
The `setup-gitops.sh` script automatically:
- Detects your Git repository URL using `git remote get-url origin`
- Updates all ArgoCD applications to use your repository
- No manual URL changes needed!

### Environment-Specific Values
Create environment-specific value files:
- `gitops/control-plane/values-dev.yaml`
- `gitops/control-plane/values-staging.yaml`
- `gitops/control-plane/values-prod.yaml`

### Secret Names
Customize secret names in `gitops/control-plane/values.yaml` to match your environment.